(self.webpackChunkgame_score_sdk=self.webpackChunkgame_score_sdk||[]).push([[614],{501:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});class s{constructor(){this.canAddShortcut=!1}addShortcut(){return e=this,t=void 0,s=function*(){return!1},new((i=void 0)||(i=Promise))((function(r,n){function a(e){try{d(s.next(e))}catch(e){n(e)}}function o(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}d((s=s.apply(e,t||[])).next())}));var e,t,i,s}}},5572:(e,t,i)=>{"use strict";i.d(t,{VK:()=>s,yl:()=>r});const s={success:!0,payload:{}},r={success:!1,payload:{}}},2712:(e,t,i)=>{"use strict";i.d(t,{aD:()=>l,FU:()=>y,hc:()=>p});const s=(e,t)=>({type:e,getLink:t}),r=s("facebook",(e=>`//www.facebook.com/sharer/sharer.php?u=${e.url}`)),n=s("whatsapp",(e=>`//api.whatsapp.com/send?text=${e.text}%20${e.url}`)),a=s("telegram",(e=>`//t.me/share/url?url=${e.url}&text=${e.text}`)),o=s("vkontakte",(e=>`//vk.com/share.php?url=${e.url}&title=${e.text}&image=${e.image}`)),d=s("twitter",(e=>`//twitter.com/share?text=${e.text}&url=${e.url}`)),h=s("odnoklassniki",(e=>`//connect.ok.ru/offer?url=${e.url}&title=${e.text}&imageUrl=${e.image}`)),u=s("viber",(e=>`viber://forward?text=${e.text}%20${e.url}`)),c=s("moymir",(e=>`//connect.mail.ru/share?url=${e.url}&title=${e.text}&image_url=${e.image}`)),l=[n,a,o,h,u,c],y=[r,d,a,n,u],p=[r,d,a,n,u,o,h,c]},4917:(e,t,i)=>{"use strict";function s({src:e,check:t}){return new Promise(((i,s)=>{let r=0;if(null==t?void 0:t(window))return void i();function n(){t?t(window)&&(clearInterval(r),i()):i()}if(document.querySelector(`script[src="${e}"]`)&&t)return void(r=setInterval(n,100));var a=document.getElementsByTagName("script")[0];const o=document.createElement("script");o.src=e,o.onload=n,o.onerror=s,a.parentNode.insertBefore(o,a),t&&(r=setInterval(n,100))}))}i.d(t,{Z:()=>s})},209:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});const s={stringify:e=>btoa(encodeURIComponent(JSON.stringify(e))),parse(e){if(!e)return{};const t=function(e){try{return JSON.parse(decodeURIComponent(atob(e)||"{}"))}catch(e){return""}}(e);return Object.keys(t).length>0?t:JSON.parse(function(e){try{return JSON.parse(atob(e)||"{}")}catch(e){return""}}(e)||"{}")}}},8866:(e,t,i)=>{"use strict";function s(e){return new Promise((t=>setTimeout(t,e)))}i.d(t,{Z:()=>s})},1069:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>_});var s=i(6388),r=i(4917),n=i(6558),a=i(8866),o=i(8293),d=i(209),h=function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function a(e){try{d(s.next(e))}catch(e){n(e)}}function o(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}d((s=s.apply(e,t||[])).next())}))};class u extends s.Z{constructor(e,t){super(),this.gp=e,this.config=t,this.readyFullscreen=(0,o._)(),this.readyRewardedAds=(0,o._)(),this.readyPlayingRewardedAds=(0,o._)(),this.readyShare=(0,o._)(),this.readyInvite=(0,o._)(),this.readyJoinGroup=(0,o._)(),this.readyPayment=(0,o._)(),this.readyGetPageInfo=(0,o._)(),this.readyPermissions=(0,o._)(),this.readyRequestBannerAds=(0,o._)(),this.readyShowBannerAds=(0,o._)(),this.readyHideBannerAds=(0,o._)(),this.readyIsBannerAdsVisible=(0,o._)()}get appUrl(){return`https://ok.ru/game/${this.appId}`}get isStickyBannerAvailable(){return this.isBetaStickyWebEnabled?!this.isMobile||"ios"!==this.mobilePlatform:"android"===this.mobilePlatform}init(){var e,t;const{searchParams:i}=new URL(window.location.href);this.authSig=i.get("auth_sig"),this.loggedUserId=i.get("logged_user_id"),this.savedState=i.get("saved_state"),this.isMobile=i.has("mob"),this.mobilePlatform=null!==(e=i.get("mob_platform"))&&void 0!==e?e:void 0,this.sessionKey=i.get("session_key"),this.sessionSecretKey=i.get("session_secret_key"),this.appId=(null===(t=i.get("apiconnection"))||void 0===t?void 0:t.split("_")[0])||"",this.userName=i.get("user_name"),this.userImage=i.get("user_image"),this.isBetaStickyWebEnabled=i.has("_gp_ok_beta_sticky_web");const s=(0,o._)();this.ready=s.ready,window.API_callback=(e,t,i)=>{switch(e){case"showAd":if("app_in_fullscreen"===i)return void this.showFullscreen(!0);this.readyFullscreen.done("ok"===t);break;case"loadAd":this.readyRewardedAds.done("ok"===t);break;case"showLoadedAd":if("app_in_fullscreen"===i)return void this.showRewardedVideo(!0);this.readyPlayingRewardedAds.done("ok"===t);break;case"postMediatopic":this.readyShare.done("ok"===t);break;case"showInvite":this.readyInvite.done("ok"===t);break;case"joinGroup":this.readyJoinGroup.done("ok"===t);break;case"showPayment":case"showPaymentSubscription":this.readyPayment.done("ok"===t);break;case"getPageInfo":this.readyGetPageInfo.done(JSON.parse(i));break;case"showPermissions":this.readyPermissions.done("ok"===t);break;case"requestBannerAds":this.readyRequestBannerAds.done("ad_loaded"===i);break;case"showBannerAds":this.readyShowBannerAds.done("true"===i);break;case"hideBannerAds":this.readyHideBannerAds.done("true"===i);break;case"isBannerAdsVisible":this.readyIsBannerAdsVisible.done("true"===i)}this._events.emit("native:event",e,t,i),"ok"!==t&&n.kg.error(t,i)};const a=[(0,r.Z)({src:"//api.ok.ru/js/fapi5.js",check:e=>"FAPI"in e})];return Promise.all(a).then((()=>{this.fapi=window.FAPI;const e=this.fapi.Util.getRequestParameters();this.serverUrl=e.api_server,this.fapi.init(e.api_server,e.apiconnection,(()=>s.done(this)),n.kg.error),this.shareParams=this.fapi.Util.getRequestParameters().custom_args||"";const t=this.shareParams.toString();if(t.includes("_gpParams=")){let e=decodeURIComponent(t.split("_gpParams=")[1]);try{this.shareParams=d.Z.parse(e)}catch(e){n.kg.error(e)}}else this.shareParams={};this.isBetaStickyWebEnabled||(this.isBetaStickyWebEnabled=t.includes("_gp_ok_beta_sticky_web"))})).catch(n.kg.error).finally((()=>s.done(this))),window.addEventListener("resize",(()=>this.recalcPageSize())),s.ready.then((()=>this.recalcPageSize())),s.ready}recalcPageSize(){return h(this,void 0,void 0,(function*(){if(this.isMobile)return;this.readyGetPageInfo=(0,o._)(),this.fapi.UI.getPageInfo();const{innerWidth:e,innerHeight:t}=yield this.readyGetPageInfo.ready;if(e<1024)return;const i=t-85;this.fapi.UI.setWindowSize(e,i>800?800:i)}))}getPlayer(){const e=(0,o._)();return e.done({id:this.loggedUserId,name:this.userName,photoSmall:this.userImage,photoMedium:this.userImage,photoLarge:this.userImage}),e.ready}login(e){this.fapi.UI.showLoginSuggestion(e)}showRewardedVideo(e=!1){return h(this,void 0,void 0,(function*(){if(this.gp.ads.isAdblockEnabled)return!1;const t=this.gp.fullscreen.isEnabled;return e&&(this.gp.fullscreen.close(),yield(0,a.Z)(200)),e||(this.readyRewardedAds=(0,o._)(),this.fapi.UI.loadAd(),yield this.readyRewardedAds.ready,this.readyPlayingRewardedAds=(0,o._)()),this.fapi.UI.showLoadedAd(),this.readyPlayingRewardedAds.ready.then((()=>h(this,void 0,void 0,(function*(){e&&t&&(yield(0,a.Z)(200),this.gp.fullscreen.open())})))),this.readyPlayingRewardedAds.ready}))}showPreloader(){return this.showFullscreen()}showFullscreen(e=!1){return h(this,void 0,void 0,(function*(){if(this.gp.ads.isAdblockEnabled)return!1;const t=this.gp.fullscreen.isEnabled;return e&&(this.gp.fullscreen.close(),yield(0,a.Z)(200)),e||(this.readyFullscreen=(0,o._)()),this.fapi.UI.showAd(),this.readyFullscreen.ready.then((()=>h(this,void 0,void 0,(function*(){e&&t&&(yield(0,a.Z)(200),this.gp.fullscreen.open())})))),this.readyFullscreen.ready}))}showSticky(e){return h(this,void 0,void 0,(function*(){const t=(0,o._)();return this.readyRequestBannerAds=(0,o._)(),this.fapi.invokeUIMethod("requestBannerAds"),(yield this.readyRequestBannerAds.ready)?(this.readyShowBannerAds=(0,o._)(),this.fapi.invokeUIMethod("showBannerAds",e.position),t.done(!0),this.readyShowBannerAds.ready):(t.done(!1),t.ready)}))}refreshSticky(e){return h(this,void 0,void 0,(function*(){return!!(yield this.isAdBannerVisible())||this.showSticky(e)}))}closeSticky(){return h(this,void 0,void 0,(function*(){return this.readyHideBannerAds=(0,o._)(),this.fapi.invokeUIMethod("hideBannerAds"),this.readyHideBannerAds.ready}))}isAdBannerVisible(){return h(this,void 0,void 0,(function*(){return this.readyIsBannerAdsVisible=(0,o._)(),this.fapi.invokeUIMethod("isBannerAdsVisible"),this.readyIsBannerAdsVisible.ready}))}get stickyBannerConfig(){const e="android"===this.mobilePlatform;return{isOverlapping:this.isStickyBannerAvailable,height:e?102:96}}share(e){return this.post(e)}post(e){this.readyShare=(0,o._)();const t=[];e.text&&t.push({type:"text",text:e.text}),e.url&&t.push({type:"link",url:e.url});const i=function(e){if(!e)return"";const t=parseInt(e,10);if(t>0)return String(t);try{const t=new URL(e),i=parseInt(t.searchParams.get("_imageId"),10)||parseInt(t.searchParams.get("id"),10)||0;return i>0?String(i):""}catch(e){return""}}(e.image);return i&&t.push({type:"photo",list:[{photoId:i}]}),this.fapi.UI.postMediatopic({media:t},!1),this.readyShare.ready}invite(e){return this.readyInvite=(0,o._)(),this.fapi.UI.showInvite(e.text||""),this.readyInvite.ready}joinCommunity(e){return h(this,void 0,void 0,(function*(){const t=parseInt(e,10)||0;if(!t)throw new Error(`Empty or wrong group ID: "${e}"`);return this.readyInvite=(0,o._)(),this.fapi.invokeUIMethod("joinGroup",t),this.readyInvite.ready}))}purchase(e){return this.readyPayment=(0,o._)(),this.fapi.UI.showPayment(e.name,e.description,e.id,e.price,null,null,"ok","true"),this.readyPayment.ready}requestScopes(e){return h(this,void 0,void 0,(function*(){const t=[];return yield Promise.all(e.map((e=>new Promise((i=>{this.fapi.Client.call({method:"users.hasAppPermission",ext_perm:e},((s,r)=>{r||t.push(e),i()}))}))))),0===t.length||(this.readyPermissions=(0,o._)(),this.fapi.UI.showPermissions(JSON.stringify(t)),this.readyPermissions.ready)}))}subscribe(e,t){return h(this,void 0,void 0,(function*(){if(this.readyPayment=(0,o._)(),this.fapi.invokeUIMethod("showPaymentSubscription",e.id,e.price),!(yield this.readyPayment.ready))throw new Error("failed");return{}}))}unsubscribe(e){return h(this,void 0,void 0,(function*(){throw new Error("unsupported")}))}makeShareUrl(e){const t=d.Z.stringify(e),i=new URL(this.gp.app.url);return i.searchParams.set("_gpParams",t),i.href||""}getShareParam(e){return this.shareParams?this.shareParams[e]:""}}var c=function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function a(e){try{d(s.next(e))}catch(e){n(e)}}function o(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}d((s=s.apply(e,t||[])).next())}))};class l{constructor(e){this.sdk=e,this.stickyBannerConfig=this.sdk.stickyBannerConfig,this.isFullscreenAvailable=!0,this.isRewardedAvailable=!0,this.isPreloaderAvailable=!0}get isStickyAvailable(){return this.sdk.isStickyBannerAvailable}showPreloader(){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.showPreloader().catch((()=>!1))}))}showFullscreen(){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.showFullscreen().catch((()=>!1))}))}showRewardedVideo(){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.showRewardedVideo().catch((()=>!1))}))}showSticky(e){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.showSticky(e).catch((()=>!1))}))}refreshSticky(e){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.refreshSticky(e).catch((()=>!1))}))}closeSticky(){return c(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.closeSticky()}))}}var y=function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function a(e){try{d(s.next(e))}catch(e){n(e)}}function o(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}d((s=s.apply(e,t||[])).next())}))};class p{constructor(e){this.sdk=e,this.hasCredetials=!1,this.userId=""}getPlayerAuthInfo(){return y(this,void 0,void 0,(function*(){const e=(0,o._)();yield this.sdk.ready;const t={authSig:this.sdk.authSig,loggedUserId:this.sdk.loggedUserId,sessionKey:this.sdk.sessionKey,savedState:this.sdk.savedState};return this.userId=t.loggedUserId,this.hasCredetials=!!t.authSig&&!!t.loggedUserId&&"0"!=t.loggedUserId&&!!t.sessionKey,e.done(t),e.ready}))}getPlayerContext(){return y(this,void 0,void 0,(function*(){const e=yield this.getPlayerAuthInfo();return{platformData:e,key:e.loggedUserId}}))}loginPlayer(e){return y(this,void 0,void 0,(function*(){return yield this.sdk.ready,yield this.sdk.login(e._authInfo.secretCode),this.sdk.getPlayer()}))}getPlayer(){return y(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.getPlayer()}))}publishRecord(e){}isPlatformAvatar(e){return e.includes("i.mycdn.me")}}var f=i(2712),v=i(5942),g=i(5572);class m{constructor(e){this.sdk=e,this.hasIntegratedAuth=!0,this.isExternalLinksAllowed=!1,this.isSecretCodeAuthAvailable=!1,this._hasAuthModal=!0,this.type=v.z.OK,this.socialNetworks=f.aD,this.isSupportsImageUploading=!1}getSDK(){return this.sdk}getNativeSDK(){return this.sdk.fapi}requestPermissions(e){return t=this,i=void 0,r=function*(){const t=[];if(e.allowUploadImages&&t.push("PHOTO_CONTENT"),0===t.length)return g.yl;try{return{success:yield this.sdk.requestScopes(t),payload:{serverUrl:this.sdk.serverUrl,sessionKey:this.sdk.sessionKey,sessionSecretKey:this.sdk.sessionSecretKey}}}catch(e){return g.yl}},new((s=void 0)||(s=Promise))((function(e,n){function a(e){try{d(r.next(e))}catch(e){n(e)}}function o(e){try{d(r.throw(e))}catch(e){n(e)}}function d(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(a,o)}d((r=r.apply(t,i||[])).next())}));var t,i,s,r}uploadImage(){return null}}var k=function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function a(e){try{d(s.next(e))}catch(e){n(e)}}function o(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}d((s=s.apply(e,t||[])).next())}))};class w{constructor(e){this.sdk=e,this.isSupportsShare=!0,this.isSupportsNativeShare=!0,this.isSupportsNativePosts=!0,this.isSupportsNativeInvite=!0,this.isSupportsNativeCommunityJoin=!0,this.canJoinCommunity=!0,this.isSupportShareParams=!0}get shareParams(){return this.sdk.shareParams}share(e){return k(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.share(e)}))}post(e){return k(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.post(e)}))}invite(e){return k(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.invite(e)}))}joinCommunity(e){return this.sdk.joinCommunity(e)}makeShareUrl(e){return this.sdk.makeShareUrl(e)}getShareParam(e){return this.sdk.getShareParam(e)}}var P=function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function a(e){try{d(s.next(e))}catch(e){n(e)}}function o(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}d((s=s.apply(e,t||[])).next())}))};class b{constructor(e){this.sdk=e,this.isSupportsSubscriptions=!0,this.isSupportsPayments=!0,this.isServerValidation=!0}mapProducts(e,t){return P(this,void 0,void 0,(function*(){return{products:t.products.map((e=>Object.assign(Object.assign({},e),{currencySymbol:"OK",currency:"OK"}))),playerPurchases:t.playerPurchases}}))}consumeAllExpired(e,t){return P(this,void 0,void 0,(function*(){}))}fetchPurchases(){return P(this,void 0,void 0,(function*(){return{payload:{},purchases:[]}}))}purchase(e){return P(this,void 0,void 0,(function*(){if(yield this.sdk.ready,!(yield this.sdk.purchase(e)))throw new Error("payment_rejected");return{}}))}consume(e){return P(this,void 0,void 0,(function*(){return{}}))}subscribe(e,t){return P(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.subscribe(e,t)}))}unsubscribe(e,t){return P(this,void 0,void 0,(function*(){return yield this.sdk.ready,this.sdk.unsubscribe(t)}))}}var S=i(501);function _(e){return t=this,i=void 0,r=function*(){const t=new u(e.gp,{}),[,,i]=yield Promise.all([t.init(),e.setupStorage([]),e.fetchConfig()]),s=new p(t),r=new l(t);return{appAdapter:new S.Z,adsAdapter:r,playerAdapter:s,platformAdapter:new m(t),socialsAdapter:new w(t),paymentsAdapter:new b(t),projectConfig:i}},new((s=void 0)||(s=Promise))((function(e,n){function a(e){try{d(r.next(e))}catch(e){n(e)}}function o(e){try{d(r.throw(e))}catch(e){n(e)}}function d(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(a,o)}d((r=r.apply(t,i||[])).next())}));var t,i,s,r}}}]);